language: go
go:
  - 1.13.x
  - 1.14.x
before_install:
  - sudo apt -y install upx
addons:
  apt:
    update: true
script:
  - go test ./...
  - go get github.com/mitchellh/gox
  - gox -ldflags="-s -w" -output="$TRAVIS_BUILD_DIR/build/"
  - for i in `ls $TRAVIS_BUILD_DIR/build/`; do upx --best $i; done
  - ls -al "$TRAVIS_BUILD_DIR/build/"
deploy:
  provider: releases
  api_key:
    secure: $SECURE
  file:
    - "$TRAVIS_BUILD_DIR/build/Platypus_darwin_386"
    # - "$TRAVIS_BUILD_DIR/build/Platypus_darwin_amd64"
    # - "$TRAVIS_BUILD_DIR/build/Platypus_freebsd_386"
    # - "$TRAVIS_BUILD_DIR/build/Platypus_freebsd_amd64"
    # - "$TRAVIS_BUILD_DIR/build/Platypus_freebsd_arm"
    - "$TRAVIS_BUILD_DIR/build/Platypus_linux_386"
    # - "$TRAVIS_BUILD_DIR/build/Platypus_linux_amd64"
    # - "$TRAVIS_BUILD_DIR/build/Platypus_linux_arm"
    # - "$TRAVIS_BUILD_DIR/build/Platypus_linux_mips"
    # - "$TRAVIS_BUILD_DIR/build/Platypus_linux_mips64"
    # - "$TRAVIS_BUILD_DIR/build/Platypus_linux_mips64le"
    # - "$TRAVIS_BUILD_DIR/build/Platypus_linux_mipsle"
    # - "$TRAVIS_BUILD_DIR/build/Platypus_linux_s390x"
    # - "$TRAVIS_BUILD_DIR/build/Platypus_netbsd_386"
    # - "$TRAVIS_BUILD_DIR/build/Platypus_netbsd_amd64 "
    # - "$TRAVIS_BUILD_DIR/build/Platypus_netbsd_arm"
    # - "$TRAVIS_BUILD_DIR/build/Platypus_openbsd_386"
    # - "$TRAVIS_BUILD_DIR/build/Platypus_openbsd_amd64"
    - "$TRAVIS_BUILD_DIR/build/Platypus_windows_386.exe"
    # - "$TRAVIS_BUILD_DIR/build/Platypus_windows_amd64.exe"
  on:
    repo: WangYihang/Platypus
    tags: true
  skip_cleanup: 'true'
