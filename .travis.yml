language: go

go:
  - 1.11.x
  - 1.12.x
  - 1.13.x
  - 1.14.x

script:
  - go test ./...
  - go get github.com/mitchellh/gox
  - gox -ldflags "-s -w" platypus.go

deploy:
  provider: releases
  skip_cleanup: true
  file: 
    - "$TRAVIS_BUILD_DIR/Platypus_linux_386"
    - "$TRAVIS_BUILD_DIR/Platypus_linux_amd64"
    - "$TRAVIS_BUILD_DIR/Platypus_linux_arm"
    - "$TRAVIS_BUILD_DIR/Platypus_linux_mipsle"
    - "$TRAVIS_BUILD_DIR/Platypus_darwin_386"
    - "$TRAVIS_BUILD_DIR/Platypus_darwin_amd64"
    - "$TRAVIS_BUILD_DIR/Platypus_freebsd_386"
  api_key:
    secure: "$API_KEY"
  on:
    tags: true
    draft: false
